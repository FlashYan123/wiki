---
order: 2
authors:
  - Enigma_ZXC
---

# Velocity

:::warning :construction: Under construction...

Эта статья требует срочного улучшения.

Комментарий: *Статья не затрагивает все моменты (рассказывается только про modern переадресацию), а также найдено большое количество ошибок и нарушений энциклопедического стиля, часть из которых могла остаться незамеченной.*

Вы можете помочь, [отправив необходимые исправления](https://github.com/play2go/wiki/blob/main/src/minecraft/cores/velocity.md) и сняв эту пометку (выставлено 20 июня 2024).
:::

## Что такое Velocity?

Velocity - это современный высокопроизводительный прокси. Разработанный с учётом производительности и стабильности, он является альтернативой Waterfall (разработка ныне прекращена) и BungeeCord.

## Почему стоит использовать Velocity

### Из старого - в новое

Velocity - это лучшее программное обеспечение для прокси. Разработанный с учётом производительности и масштабируемости, он намного быстрее и стабильнее, чем BungeeCord.

### Активное и растущее сообщество

Velocity имеет активное и растущее сообщество администраторов и разработчиков серверов. Если у вас возникнут какие-либо проблемы, вы можете пообщаться с ними в [Discord](https://discord.com/invite/papermc) и получить поддержку в режиме реального времени.

### Множество плагинов на выбор

В то время как BungeeCord имеет больше стороннего программного обеспечения из-за более длительного срока службы, Velocity не испытывает недостатка в самом необходимом. В Velocity есть всё, что нужно для начала работы, и каждый день добавляется ещё больше.

## Начало работы

Чтобы начать работу с Velocity, вам необходимо [загрузить](https://papermc.io/downloads/velocity) и установить последнюю версию программного обеспечения прокси-сервера.

Для работы Velocity также обязательно должна быть установлена Java версии 11 или выше.

После запуска Velocity, теперь всё готово к полной настройке прокси. Наберите в консоли команду `end` и нажмите Enter. Прокси-сервер будет выключен.

Теперь нужно настроить каждый сервер на приём соединений от прокси.

## Настройка прокси

Velocity - это очень гибкий прокси. Хотя большинству пользователей не понадобится менять всё в конфигурации, есть множество опций, описанных на справочной странице конфигурации вместе с объяснением того, как работает каждая опция. Однако мы сделаем самый минимум, чтобы запустить прокси.

Откройте файл `velocity.toml` в текстовом редакторе и найдите раздел `[servers]`. В этом разделе указываются серверы, к которым может подключаться Velocity. Вот как будет выглядеть раздел `[servers]` изначально:

```toml
[servers]
# Configure your servers here. Each key represents the server's name, and the value
# represents the IP address of the server to connect to.
lobby = "127.0.0.1:30066"
factions = "127.0.0.1:30067"
minigames = "127.0.0.1:30068"

# In what order we should try servers when a player logs in or is kicked from a server.
try = [
  "lobby"
]
```

В левой части указывается имя сервера (например, lobby), а справа - строку, указывающую IP-адрес и порт для сервера. Теперь вам нужно добавить свои серверы в список. Вы можете изменять этот список по мере необходимости.

Настройка try является особенной. Это список серверов, к которым Velocity должен попытаться подключить игрока, когда игрок впервые заходит на прокси-сервер или когда его выкидывает с сервера. Если вы решили изменить имя сервера, то в этом списке вместо lobby следует указать имя, которое вы выбрали для первого сервера, на который игрок должен войти первым.

**Следующая настройка является общей и предназначена для любого сервера Minecraft. Эта настройка не только не эргономична (у игроков будут отсутствовать скины, правильные UUID, и все соединения будут казаться исходящими от прокси), но и небезопасна. После того как вы переведёте свои серверы в пиратский режим, вы должны следовать темам "Передача информации об игроках" и "Защита ваших серверов", чтобы завершить настройку.**

Откройте файл server.properties для каждого из ваших серверов и установите для параметра online-mode значение false. Это позволит Velocity подключиться к вашему серверу. Как только вы закончите, перезапустите ваш сервер. Хотя Velocity уже готов к использованию, вы почти наверняка захотите [защитить свои серверы](https://docs.papermc.io/velocity/security) и настроить [передачу информации об игроках](https://docs.papermc.io/velocity/player-information-forwarding).

## Настройка пересылки информации об игроках

Velocity поддерживает передачу информации о ваших игроках на ваши серверы, такой как IP-адреса, UUID и скины. Velocity поддерживает три формата пересылки:

- `Modern forwarding` это пользовательский формат передачи (современная передача), который является более безопасным.

- `BungeeCord forwarding` (также известный как legacy forwarding), который имеет лучшую совместимость, но является небезопасным.

- `BungeeGuard`, который представляет собой то же самое, что и BungeeCord forwarding, но включает секретный ключ. Это лучше, чем только BungeeCord forwarding, но менее идеально, чем Velocity modern forwarding.

:::info Важно
Вы можете выбрать только один из этих форматов переадресации. В настоящее время невозможно "смешивать и сочетать" режимы пересылки или использовать все форматы пересылки вместе. Если вы поддерживаете версии, использующих только **Minecraft 1.13** и выше, используйте modern переадресацию в Velocity, в противном случае вы должны использовать пересылку BungeeCord или BungeeGuard.
:::

## Настройка `player-info-forwarding-mode: modern`

**modern** переадресация пересылает всю информацию игрока в двоичном формате и использует MAC-код, чтобы было гораздо сложнее обмануть сервер, выдавая себя за ваш Velocity. Однако он доступен только для Minecraft 1.13 и выше.

Чтобы использовать её с любой поддерживаемой реализацией сервера, установите параметр player-info-forwarding в `velocity.toml` на `modern`. Затем необходимо убедиться, что ваш сервер правильно настроен для использования переадресации Velocity.

### Настройка `player-info-forwarding-mode: modern` для Paper

Paper 1.14+ и выше, а также Paper 1.13.1/1.13.2 build 377 и выше поддерживают современную переадресацию Velocity.

Во-первых, вам необходимо отключить переадресацию BungeeCord, если она была включена ранее. Убедитесь, что settings.bungeecord имеет значение false в вашем `spigot.yml`.

```yaml
settings:
    debug: false
    bungeecord: false
```

В `config/paper-global.yml` установите velocity-support.enabled в true и velocity-support.secret в соответствии с секретом в вашем `velocity.toml`. Вы также должны установить velocity-support.online-mode на значение online-mode в вашем `velocity.toml`. После завершения редактирования `paper.yml` перезагрузите сервер.

```yaml
  velocity-support:
    enabled: true
    online-mode: false
    secret: Секретный ключ
```
